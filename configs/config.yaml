# ===================================================================
#      Configuration File for EventMamba-FX (Optimized Structure)
# ===================================================================

# --- 运行设置 (Run Settings) ---
run:
  mode: train         # 运行模式: 'train' or 'evaluate'
  experiment_name: event_denoising_mamba_v1
  
# --- 数据集设置 (Data Settings) ---
data:
  # 数据文件路径 (混合事件作为输入，包含原始+炫光)
  train_path: "./data/mixed_events/train_data.txt"
  val_path: "./data/mixed_events/val_data.txt"
  test_path: "./data/mixed_events/test_data.txt"
  
  # 事件相机分辨率 (这是数据的固有属性)
  resolution_h: 260
  resolution_w: 346

  # DataLoader 参数
  sequence_length: 64     # 输入给模型的序列长度 (reduced for testing)
  num_workers: 0          # 加载数据的进程数 (set to 0 for debugging)

# --- 模型架构设置 (Model Architecture Settings) ---
model:
  # 特征提取器输出的维度，同时也是Mamba嵌入层之前的输入维度
  input_feature_dim: 32     
  
  # Mamba 骨干网络参数 - 可根据显卡性能调整
  d_model: 128            # Mamba 内部的工作维度 (可调整: 64/128/256/512)
  d_state: 16             # SSM 状态空间的维度 (可调整: 8/16/32/64)
  d_conv: 4               # Mamba 内部1D卷积核大小 (可调整: 3/4/5)
  expand: 2               # Mamba 块的扩展因子 (可调整: 1/2/4)
  n_layers: 4             # 堆叠的 Mamba 模块数量 (可调整: 2/4/6/8/12)
  
  # 更强显卡建议配置 (注释掉的高性能版本):
  # d_model: 512           # 4倍容量
  # d_state: 64            # 4倍状态空间  
  # n_layers: 8            # 2倍深度
  # expand: 4              # 2倍扩展

# --- 特征提取器算法设置 (Feature Extractor Algorithm Settings) ---
feature_extractor:
  # PFD 特征提取参数
  pfd_time_window: 25000      # Time window for Mf calculation (25ms in µs)
  pfd_neighborhood_size: 3    # Neighborhood size for PFD features (1=1x1, 3=3x3, 5=5x5)
  
  # 原有参数 (保持向后兼容)
  coarse_time_window: 2000    # (δtc, in µs)
  coarse_support_threshold: 1 # (μ)
  coarse_neighborhood_size: 3 # (n x n)
  fine_time_window: 30000     # (δtf, in µs)
  fine_neighborhood_size: 3   # (n x n)

# --- 训练设置 (Training Settings) ---
training:
  epochs: 2
  batch_size: 32
  learning_rate: 0.001
  checkpoint_dir: "./checkpoints" # 保存模型权重的目录

# --- 评估设置 (Evaluation Settings) ---
evaluation:
  batch_size: 64
  checkpoint_path: "./checkpoints/best_model.pth" # 评估时加载的模型路径