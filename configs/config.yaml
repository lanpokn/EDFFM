# ===================================================================
#      Configuration File for EventMamba-FX (TBPTT Architecture)
# ===================================================================

# --- è¿è¡Œè®¾ç½® (Run Settings) ---
run:
  mode: train         # è¿è¡Œæ¨¡å¼: 'train' or 'evaluate'

# --- æ•°æ®ç®¡çº¿è®¾ç½® (Data Pipeline Settings) ---
data_pipeline:
  # ğŸš¨ å…³é”®å¼€å…³: 'generate' æˆ– 'load'
  mode: 'load'           # 'generate': å®æ—¶ç”Ÿæˆå¹¶å­˜æ¡£, 'load': ä»ç£ç›˜åŠ è½½é¢„ç”Ÿæˆæ•°æ®
  
  # 'generate'å’Œ'load'æ¨¡å¼éƒ½éœ€è¦çš„å­˜æ¡£è·¯å¾„
  h5_archive_path: 'data/generated_h5'

# --- æ•°æ®é›†è®¾ç½® (Data Settings) ---
data:
  # èƒŒæ™¯äº‹ä»¶æ•°æ®è·¯å¾„ (ç®€åŒ–çš„H5æ–‡ä»¶ç›®å½•)
  dsec_path: "data/bg_events"
  
  # Flare7Kppæ•°æ®é›†è·¯å¾„ (Compound_Flareæ•£å°„æ•°æ®)
  flare7k_path: "/mnt/e/2025/physical_deflare/Datasets/Flare7Kpp/Flare7Kpp"
  
  # äº‹ä»¶ä»¿çœŸå™¨é€‰æ‹© (Event Simulator Selection)
  event_simulator:
    type: "dvs_voltmeter"
    
    # DVS-Voltmeter é…ç½®
    dvs_voltmeter:
      simulator_path: "/mnt/e/2025/event_flick_flare/main/simulator/DVS-Voltmeter-main"
      timeout_sec: 60
      
      # DVSå‚æ•°è°ƒä¼˜ (éšæœºåŒ–k1å‚æ•°)
      parameters:
        dvs346_k: [2.5, 20, 0.0001, 1e-7, 5e-9, 0.00001]
  
  # éšæœºåŒ–è®­ç»ƒæ•°æ®ç”Ÿæˆç­–ç•¥
  randomized_training:
    background_duration_range: [0.1, 0.3]      # 100-300msèƒŒæ™¯äº‹ä»¶çª—å£
    background_contains_flare_prob: 0.75       # 75%æƒ…å†µä¸‹èƒŒæ™¯åŒ…å«ç‚«å…‰
    flare_only_prob: 0.1                       # 10%åªæœ‰ç‚«å…‰äº‹ä»¶
    background_only_prob: 0.15                 # 15%åªæœ‰èƒŒæ™¯äº‹ä»¶
    
  # ç‚«å…‰åˆæˆå‚æ•°
  flare_synthesis:
    realistic_frequencies:
      power_50hz: 100.0                  # 50Hzç”µç½‘è§å…‰ç¯é¢‘ç‡
      power_60hz: 120.0                  # 60Hzç”µç½‘è§å…‰ç¯é¢‘ç‡
    
    frequency_variation: 5.0             # Â±5Hzéšæœºå˜åŒ–
    min_samples_per_cycle: 48            # æ¯ä¸ªé—ªçƒå‘¨æœŸæœ€å°‘é‡‡æ ·ç‚¹æ•°
    max_fps: 6000                        # æœ€å¤§å¸§ç‡é™åˆ¶
    
    flicker_curves: ["sine", "square", "triangle", "exponential"]
    position_random: true                # éšæœºflareä½ç½®
    intensity_scale: [0.8, 1.2]        # å¼ºåº¦ç¼©æ”¾èŒƒå›´
    
    duration_range: [0.05, 0.15]       # ç‚«å…‰åºåˆ—æ—¶é•¿èŒƒå›´ 50-150ms
    min_intensity_baseline: [0.0, 0.7]  # æœ€ä½å¼ºåº¦éšæœºèŒƒå›´ (0-70%)
    max_intensity: 1.0                  # æœ€å¤§å¼ºåº¦ (100%)
  
  # äº‹ä»¶ç›¸æœºåˆ†è¾¨ç‡ (DSECåˆ†è¾¨ç‡)
  resolution_h: 480
  resolution_w: 640
  
  # Debugè®¾ç½®
  max_samples_debug: 8   # Debugæ¨¡å¼æ ·æœ¬æ•°é™åˆ¶

# --- æ¨¡å‹æ¶æ„è®¾ç½® (Model Architecture Settings) ---
model:
  # ç‰¹å¾æå–å™¨è¾“å‡ºçš„ç»´åº¦ (å½“å‰4ç»´å¿«é€Ÿç‰¹å¾)
  input_feature_dim: 4
  
  # Mamba éª¨å¹²ç½‘ç»œå‚æ•°
  d_model: 512            # Mamba å†…éƒ¨å·¥ä½œç»´åº¦
  d_state: 64             # SSM çŠ¶æ€ç©ºé—´ç»´åº¦
  d_conv: 5               # Mamba å†…éƒ¨1Då·ç§¯æ ¸å¤§å°
  expand: 4               # Mamba å—æ‰©å±•å› å­
  n_layers: 12            # å †å çš„ Mamba æ¨¡å—æ•°é‡

# --- ç‰¹å¾æå–å™¨ç®—æ³•è®¾ç½® (Feature Extractor Algorithm Settings) ---
feature_extractor:
  # PFD ç‰¹å¾æå–å‚æ•° (æš‚æ—¶ç¦ç”¨ï¼Œä¿ç•™é…ç½®)
  pfd_time_window: 25000      # Time window for Mf calculation (25ms in Âµs)
  pfd_neighborhood_size: 3    # Neighborhood size for PFD features (3x3)

# --- è®­ç»ƒè®¾ç½® (Training Settings) ---
training:
  epochs: 10
  learning_rate: 0.0005                         # å¤§æ¨¡å‹ä½¿ç”¨è¾ƒå°å­¦ä¹ ç‡
  checkpoint_dir: "./checkpoints"
  
  # TBPTT (Truncated Backpropagation Through Time) å‚æ•°
  chunk_size: 8192                              # TBPTTæˆªæ–­é•¿åº¦ (æ ¹æ®æ˜¾å­˜è°ƒæ•´)
  
  # æ¯ä¸ªepochçš„é•¿åºåˆ—æ•°é‡
  num_long_sequences_per_epoch: 150              # generateç”¨åºåˆ—æ•°
  
  # éªŒè¯å’Œä¿å­˜é¢‘ç‡ (åŸºäºæ­¥æ•°)
  validate_every_n_steps: 1000                  # æ¯1000ä¸ªchunkséªŒè¯ä¸€æ¬¡
  save_every_n_steps: 2000                      # æ¯2000ä¸ªchunksä¿å­˜ä¸€æ¬¡

# --- è¯„ä¼°è®¾ç½® (Evaluation Settings) ---
evaluation:
  checkpoint_path: "./checkpoints/best_model.pth"
  num_long_sequences_per_epoch: 5               # è¯„ä¼°ç”¨åºåˆ—æ•°