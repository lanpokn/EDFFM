# EventMamba-FX Data Generator Memory

## ğŸ¯ é¡¹ç›®æ ¸å¿ƒå®šä½
EventMamba-FX Data Generatoræ˜¯ä¸€ä¸ª**ä¸“ç”¨ä»¿çœŸæ•°æ®ç”Ÿæˆå™¨**ï¼Œç”¨äºç”ŸæˆåŒ…å«äº‹ä»¶ç›¸æœºèƒŒæ™¯äº‹ä»¶å’Œåˆæˆç‚«å…‰äº‹ä»¶çš„è®­ç»ƒæ•°æ®é›†ã€‚

**âš ï¸ é‡è¦ï¼šè¿™æ˜¯pure_simulationåˆ†æ”¯ï¼Œå·²å®Œå…¨ç²¾ç®€ä¸ºçº¯æ•°æ®ç”Ÿæˆå·¥å…·ï¼Œç§»é™¤äº†æ‰€æœ‰è®­ç»ƒ/æ¨ç†/è¯„ä¼°åŠŸèƒ½ã€‚**

## Environment Setup ğŸ”§ CRITICAL
- **MUST USE**: `source /home/lanpoknlanpokn/miniconda3/bin/activate event_flare`
- ç¯å¢ƒåŒ…å«å¿…éœ€ä¾èµ–ï¼šPyTorch, NumPy, H5py, OpenCV, YAML, tqdmç­‰
- Python 3.10.18ï¼Œæ— éœ€GPUï¼ˆæ•°æ®ç”Ÿæˆä¸ºCPUå¯†é›†å‹ï¼‰

## ğŸš€ ç³»ç»ŸçŠ¶æ€ï¼šçº¯æ•°æ®ç”Ÿæˆæ¨¡å¼ (2025-08-12 éªŒè¯é€šè¿‡)

### âœ… æˆåŠŸéªŒè¯çš„åŠŸèƒ½
- **æ•°æ®ç”Ÿæˆ**: å®Œå…¨æ­£å¸¸å·¥ä½œï¼Œå·²éªŒè¯ç”ŸæˆH5æ–‡ä»¶
- **Debugå¯è§†åŒ–**: å¤šåˆ†è¾¨ç‡äº‹ä»¶å¯è§†åŒ–å®Œå…¨æ­£å¸¸
- **DVSä»¿çœŸ**: DVS-Voltmeterç‰©ç†ä»¿çœŸå™¨é›†æˆæ­£å¸¸
- **ç‰¹å¾æå–**: 4Då¿«é€Ÿç‰¹å¾æå–å·¥ä½œæ­£å¸¸
- **æ–‡ä»¶å­˜æ¡£**: H5é˜²é‡åæœºåˆ¶å’Œè‡ªåŠ¨å­˜æ¡£æ­£å¸¸

### ğŸ“Š æœ€æ–°éªŒè¯ç»“æœ (2025-08-12 13:33)
```bash
# æˆåŠŸç”Ÿæˆçš„æ•°æ®æ–‡ä»¶
data/generated_h5/train/sequence_1754976690196_00000.h5  # 23MB, 966,977äº‹ä»¶
data/generated_h5/val/sequence_1754976791625_00000.h5    # 12MB, 515,144äº‹ä»¶

# æ•°æ®æ ¼å¼éªŒè¯
Train: features(966977, 4) float32 + labels(966977,) int64
Val:   features(515144, 4) float32 + labels(515144,) int64

# ç”Ÿæˆæ€§èƒ½
Training: 1åºåˆ— = 2åˆ†40ç§’ (160.42s/åºåˆ—)
Validation: 1åºåˆ— = 1åˆ†41ç§’ (101.05s/åºåˆ—)
```

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„ç»„ä»¶

### ä¸»è¦æ–‡ä»¶ç»“æ„
```
EventMamba-FX-Generator/
â”œâ”€â”€ main.py                          # æ•°æ®ç”Ÿæˆä¸»å…¥å£ âœ…
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ config.yaml                  # ä¸»é…ç½®æ–‡ä»¶ âœ…
â”‚   â””â”€â”€ config_generator.yaml        # ä¸“ç”¨ç”Ÿæˆå™¨é…ç½® âœ…
â”œâ”€â”€ src/                             # æ ¸å¿ƒç”Ÿæˆä»£ç 
â”‚   â”œâ”€â”€ unified_dataset.py           # ç»Ÿä¸€æ•°æ®é›†(generateæ¨¡å¼) âœ…
â”‚   â”œâ”€â”€ epoch_iteration_dataset.py   # ç”Ÿæˆåç«¯(è¢«unifiedè°ƒç”¨) âœ…
â”‚   â”œâ”€â”€ flare_synthesis.py           # ç‚«å…‰åˆæˆå™¨ âœ…
â”‚   â”œâ”€â”€ dvs_flare_integration.py     # DVSä»¿çœŸå™¨é›†æˆ âœ…
â”‚   â”œâ”€â”€ feature_extractor.py         # 4Dç‰¹å¾æå–å™¨ âœ…
â”‚   â”œâ”€â”€ dsec_efficient.py            # DSECæ•°æ®åŠ è½½ âœ…
â”‚   â”œâ”€â”€ h5_data_utils.py             # H5æ–‡ä»¶å¤„ç† âœ…
â”‚   â””â”€â”€ event_visualization_utils.py # äº‹ä»¶å¯è§†åŒ–(debug) âœ…
â”œâ”€â”€ simulator/
â”‚   â””â”€â”€ DVS-Voltmeter-main/          # DVSç‰©ç†ä»¿çœŸå™¨ âœ…
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ bg_events/                   # DSECèƒŒæ™¯äº‹ä»¶(è¾“å…¥) âœ…
â”‚   â””â”€â”€ generated_h5/                # ç”Ÿæˆçš„H5æ•°æ®(è¾“å‡º) âœ…
â””â”€â”€ output/
    â””â”€â”€ debug_epoch_*/               # Debugå¯è§†åŒ–è¾“å‡º âœ…
```

### æ•°æ®ç”Ÿæˆæµç¨‹
```mermaid
graph TD
    A[DSECèƒŒæ™¯äº‹ä»¶] --> C[äº‹ä»¶åˆå¹¶]
    B[DVSç‚«å…‰ä»¿çœŸ] --> C
    C --> D[4Dç‰¹å¾æå–]
    D --> E[æ ‡ç­¾ç”Ÿæˆ]
    E --> F[H5å­˜æ¡£]
    F --> G[Debugå¯è§†åŒ–]
```

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹ (æ¨è)
```bash
# æ¿€æ´»ç¯å¢ƒ
source /home/lanpoknlanpokn/miniconda3/bin/activate event_flare

# Debugæ¨¡å¼ç”Ÿæˆ (æ¨èå¼€å‘ç”¨)
python main.py --config configs/config.yaml --debug

# æ­£å¸¸æ¨¡å¼ç”Ÿæˆ
python main.py --config configs/config.yaml
```

### é…ç½®å‚æ•°è¯´æ˜
```yaml
# configs/config.yaml å…³é”®å‚æ•°
data_pipeline:
  mode: 'generate'                    # å›ºå®šä¸ºç”Ÿæˆæ¨¡å¼

generation:
  num_train_sequences: 1              # debugæ¨¡å¼è°ƒæ•´ä¸º1
  num_val_sequences: 50               # debugæ¨¡å¼è°ƒæ•´ä¸º4
  
training:  # è¿™ä¸ªé…ç½®æ®µä»è¢«epoch_iteration_dataset.pyä½¿ç”¨
  num_long_sequences_per_epoch: 1     # debugæ¨¡å¼: è®­ç»ƒåºåˆ—æ•°
  
evaluation: # è¿™ä¸ªé…ç½®æ®µä»è¢«epoch_iteration_dataset.pyä½¿ç”¨  
  num_long_sequences_per_epoch: 50    # debugæ¨¡å¼: éªŒè¯åºåˆ—æ•°
```

## ğŸ“Š æ•°æ®ç”Ÿæˆè¯¦ç»†ä¿¡æ¯

### DSECèƒŒæ™¯äº‹ä»¶æ¥æº
- **æ–‡ä»¶ä½ç½®**: `data/bg_events/*.h5` (7ä¸ªæ–‡ä»¶)
- **æ•°æ®é‡**: 32.7äº¿äº‹ä»¶ï¼Œ291ä¸ª1ç§’æ—¶é—´çª—å£
- **éšæœºåŒ–**: 50-100mséšæœºæ—¶é—´çª—å£
- **æ–‡ä»¶åˆ—è¡¨**: interlaken_00_c.h5, interlaken_00_g.h5, thun_00_a.h5, zurich_city_00_a.h5, zurich_city_01_a.h5, zurich_city_04_a.h5, zurich_city_07_a.h5

### DVSç‚«å…‰äº‹ä»¶ä»¿çœŸ
- **ä»¿çœŸå™¨**: DVS-Voltmeterç‰©ç†ä»¿çœŸå™¨(å”¯ä¸€ä¿ç•™)
- **ä»¿çœŸå™¨è·¯å¾„**: `simulator/DVS-Voltmeter-main/`
- **å‚æ•°è®¾ç½®**: k1=2.5(é™ä½æ•æ„Ÿåº¦), å®Œæ•´6å‚æ•°DVS346é…ç½®
- **æ—¶é—´çª—å£**: 30-80mséšæœºé•¿åº¦
- **å›¾åƒæº**: Flare7Kæ•°æ®é›†ï¼Œ5962å¼ ç‚«å…‰å›¾åƒ

### è¾“å‡ºæ•°æ®æ ¼å¼
```python
# H5æ–‡ä»¶ç»“æ„
features: (N, 4) float32  # [x_norm, y_norm, dt, polarity]
labels: (N,) int64        # 0=èƒŒæ™¯äº‹ä»¶, 1=ç‚«å…‰äº‹ä»¶

# ç‰¹å¾è¯´æ˜
x_norm, y_norm: å½’ä¸€åŒ–ç©ºé—´åæ ‡ [0,1]
dt: å½’ä¸€åŒ–æ—¶é—´å·® [0,1]
polarity: äº‹ä»¶ææ€§ {0, 1}
```

## ğŸ› ï¸ Debugæ¨¡å¼åŠŸèƒ½

### å¯è§†åŒ–è¾“å‡º
ä½¿ç”¨`--debug`æ ‡å¿—æ—¶ï¼Œç³»ç»Ÿç”Ÿæˆï¼š
```
output/debug_epoch_000/
â”œâ”€â”€ background_events/       # èƒŒæ™¯äº‹ä»¶å¯è§†åŒ–
â”œâ”€â”€ flare_events/           # ç‚«å…‰äº‹ä»¶å¯è§†åŒ–  
â”œâ”€â”€ merged_events/          # åˆå¹¶äº‹ä»¶å¯è§†åŒ–
â”œâ”€â”€ flare_sequence_frames/  # ç‚«å…‰åºåˆ—å¸§
â””â”€â”€ epoch_metadata.txt      # ç»Ÿè®¡ä¿¡æ¯
```

### å¤šåˆ†è¾¨ç‡åˆ†æ
```
output/debug/epoch_iteration_analysis/
â””â”€â”€ multi_resolution_sample_0/
    â”œâ”€â”€ dsec_background/    # 0.5x, 1x, 2x, 4xåˆ†è¾¨ç‡
    â”œâ”€â”€ dvs_flare/         # å¤šåˆ†è¾¨ç‡ç‚«å…‰åˆ†æ
    â””â”€â”€ merged_total/      # åˆå¹¶äº‹ä»¶åˆ†æ
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### éªŒè¯é€šè¿‡çš„æ€§èƒ½ (2025-08-12)
- **è®­ç»ƒåºåˆ—ç”Ÿæˆ**: 160.42ç§’/åºåˆ— (966,977äº‹ä»¶)
- **éªŒè¯åºåˆ—ç”Ÿæˆ**: 101.05ç§’/åºåˆ— (515,144äº‹ä»¶)
- **å†…å­˜ä½¿ç”¨**: <1GBå³°å€¼
- **æ–‡ä»¶å¤§å°**: ~23MB/è®­ç»ƒåºåˆ—, ~12MB/éªŒè¯åºåˆ—
- **ç‰¹å¾æå–**: <20ms (4Då¿«é€Ÿç‰¹å¾)

### å®¹é‡è§„åˆ’
```bash
# å°è§„æ¨¡éªŒè¯ (æ¨èå¼€å‘)
è®­ç»ƒ: 1-10åºåˆ—, éªŒè¯: 5-20åºåˆ—
ç”Ÿæˆæ—¶é—´: 10-30åˆ†é’Ÿ
å­˜å‚¨éœ€æ±‚: 100MB-1GB

# ä¸­ç­‰è§„æ¨¡è®­ç»ƒ
è®­ç»ƒ: 50-100åºåˆ—, éªŒè¯: 20-50åºåˆ—  
ç”Ÿæˆæ—¶é—´: 2-5å°æ—¶
å­˜å‚¨éœ€æ±‚: 1-5GB

# å¤§è§„æ¨¡ç”Ÿäº§
è®­ç»ƒ: 500-1000åºåˆ—, éªŒè¯: 100-200åºåˆ—
ç”Ÿæˆæ—¶é—´: 10-20å°æ—¶
å­˜å‚¨éœ€æ±‚: 10-50GB
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³
1. **ç¯å¢ƒæœªæ¿€æ´»**: å¿…é¡»ä½¿ç”¨æŒ‡å®šcondaç¯å¢ƒ
2. **DVSä»¿çœŸå™¨è¶…æ—¶**: æ£€æŸ¥simulator/DVS-Voltmeter-main/è·¯å¾„
3. **Flare7Kè·¯å¾„é”™è¯¯**: æ£€æŸ¥é…ç½®ä¸­flare7k_pathè®¾ç½®
4. **H5æ–‡ä»¶ç”Ÿæˆå¤±è´¥**: æ£€æŸ¥data/generated_h5/æƒé™
5. **ç”Ÿæˆé€Ÿåº¦æ…¢**: æ­£å¸¸ç°è±¡ï¼Œå•åºåˆ—éœ€è¦1-3åˆ†é’Ÿ

### éªŒè¯ç³»ç»Ÿå¥åº·
```bash
# å¿«é€Ÿå¥åº·æ£€æŸ¥ (2åˆ†é’Ÿ)
python main.py --config configs/config.yaml --debug

# é¢„æœŸè¾“å‡º
âœ… æ‰¾åˆ°7ä¸ªèƒŒæ™¯äº‹ä»¶æ–‡ä»¶
âœ… åŠ è½½5962å¼ ç‚«å…‰å›¾åƒ
âœ… DVSä»¿çœŸå™¨åˆå§‹åŒ–æˆåŠŸ
âœ… tqdmè¿›åº¦æ¡æ­£å¸¸æ¨è¿›
âœ… ç”ŸæˆH5æ–‡ä»¶å’Œdebugå¯è§†åŒ–
```

## ğŸ“‹ é‡è¦æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒå¿…éœ€æ–‡ä»¶ (ç¦æ­¢åˆ é™¤)
```
main.py                               # ä¸»å…¥å£
configs/config.yaml                   # ä¸»é…ç½®
src/unified_dataset.py                # æ•°æ®é›†æ ¸å¿ƒ
src/epoch_iteration_dataset.py        # ç”Ÿæˆåç«¯
src/flare_synthesis.py                # ç‚«å…‰åˆæˆ
src/dvs_flare_integration.py          # DVSé›†æˆ
src/feature_extractor.py              # ç‰¹å¾æå–
src/dsec_efficient.py                 # DSECåŠ è½½
src/h5_data_utils.py                  # H5å·¥å…·
src/event_visualization_utils.py      # å¯è§†åŒ–
simulator/DVS-Voltmeter-main/         # ä»¿çœŸå™¨ç›®å½•
data/bg_events/                       # èƒŒæ™¯æ•°æ®
```

### å·²ç§»é™¤çš„ç»„ä»¶
```
âŒ src/trainer.py, src/model.py       # è®­ç»ƒç›¸å…³
âŒ inference.py, src/predictor.py     # æ¨ç†ç›¸å…³  
âŒ src/evaluate.py                     # è¯„ä¼°ç›¸å…³
âŒ simulator/IEBCS-main/              # é¢å¤–ä»¿çœŸå™¨
âŒ simulator/V2CE-Toolbox-master/     # é¢å¤–ä»¿çœŸå™¨
âŒ checkpoints/ (3GB+)                # æ¨¡å‹æƒé‡
âŒ reports/ (20ä¸ªmdæ–‡ä»¶)              # åˆ†ææŠ¥å‘Š
âŒ src/utils/, tools/                 # å·¥å…·è„šæœ¬
```

## ğŸ”„ é…ç½®å…¼å®¹æ€§è¯´æ˜

### å½“å‰é…ç½®ç»“æ„
å°½ç®¡å·²ç²¾ç®€ä¸ºçº¯ç”Ÿæˆå™¨ï¼Œä½†ä¿æŒäº†ä¸åŸå§‹é…ç½®çš„å…¼å®¹æ€§ï¼š
- `training.num_long_sequences_per_epoch`: æ§åˆ¶è®­ç»ƒåºåˆ—æ•°
- `evaluation.num_long_sequences_per_epoch`: æ§åˆ¶éªŒè¯åºåˆ—æ•°
- `data_pipeline.mode`: å›ºå®šä¸º'generate'
- debugæ¨¡å¼ä¼šè‡ªåŠ¨è°ƒæ•´åºåˆ—æ•°é‡ä¸ºå°æ‰¹é‡

## ğŸ’¡ ä¸‹æ¬¡ä½¿ç”¨æç¤º

### é‡å¯åå¿«é€Ÿä¸Šæ‰‹æ­¥éª¤
1. **æ¿€æ´»ç¯å¢ƒ**: `source /home/lanpoknlanpokn/miniconda3/bin/activate event_flare`
2. **éªŒè¯ç³»ç»Ÿ**: `python main.py --config configs/config.yaml --debug`
3. **è§‚å¯Ÿè¾“å‡º**: ç¡®è®¤çœ‹åˆ°è¿›åº¦æ¡å’Œ"æ‰¾åˆ°7ä¸ªèƒŒæ™¯äº‹ä»¶æ–‡ä»¶"
4. **ç­‰å¾…å®Œæˆ**: debugæ¨¡å¼çº¦2-4åˆ†é’Ÿå®Œæˆ1ä¸ªè®­ç»ƒ+1ä¸ªéªŒè¯åºåˆ—
5. **æ£€æŸ¥ç»“æœ**: `ls -la data/generated_h5/train/ data/generated_h5/val/`

### æ ¸å¿ƒè®°å¿†ç‚¹
- âœ… **ç³»ç»ŸçŠ¶æ€**: çº¯æ•°æ®ç”Ÿæˆå™¨ï¼Œå·²éªŒè¯æ­£å¸¸å·¥ä½œ
- âœ… **ç”Ÿæˆæ€§èƒ½**: 2-3åˆ†é’Ÿ/åºåˆ—ï¼Œæ–‡ä»¶å¤§å°10-25MB
- âœ… **å…³é”®è·¯å¾„**: DSEC(7æ–‡ä»¶) + Flare7K(5962å›¾åƒ) + DVSä»¿çœŸå™¨
- âœ… **è¾“å‡ºæ ¼å¼**: H5æ–‡ä»¶åŒ…å«4Dç‰¹å¾å’ŒäºŒå…ƒæ ‡ç­¾
- âœ… **DebugåŠŸèƒ½**: å®Œæ•´çš„å¤šåˆ†è¾¨ç‡äº‹ä»¶å¯è§†åŒ–

---

*æœ€åéªŒè¯: 2025-08-12 13:33 - æ•°æ®ç”Ÿæˆå™¨åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼Œå·²ç”ŸæˆéªŒè¯æ•°æ®*